### --------------------------------------------------------------------------------------------------------- ###
### ---------------------------------------------Import libraries-------------------------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
import os

import pandas as pd

### --------------------------------------------------------------------------------------------------------- ###
### ------------------------------Create a directory to store prepared dataframes---------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
os.makedirs(
    name="bygroup",
    exist_ok=True
)

### --------------------------------------------------------------------------------------------------------- ###
### ----------------------------------------------Load dataset----------------------------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
df = pd.read_csv(
    "SBIC.v2/SBIC.v2.tst.csv",
    encoding="utf-8"
)

### --------------------------------------------------------------------------------------------------------- ###
### ----------Prepare subset where zero intra-group dissent within the mixed race demographic group(s)------- ###
### --------------------------------------------------------------------------------------------------------- ###
df["offensiveYN"] = df["offensiveYN"].replace({1.0: "Yes", 0.5: "Maybe", 0.0: "No"}).fillna("Incomprehensible")
group = df.groupby(["annotatorRace", "post"])["offensiveYN"]
unanimous_annotations = group.first()[group.nunique().eq(1)]
output_df = unanimous_annotations.xs("other").rename("offensiveYN_unanimous").reset_index()
output_df.to_csv("bygroup/mixed.csv", index=False, encoding="utf-8")
