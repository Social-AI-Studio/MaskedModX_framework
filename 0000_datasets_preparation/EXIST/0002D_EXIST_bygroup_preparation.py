### --------------------------------------------------------------------------------------------------------- ###
### ---------------------------------------------Import libraries-------------------------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
import os

import pandas as pd

### --------------------------------------------------------------------------------------------------------- ###
### ------------------------------Create a directory to store prepared dataframes---------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
os.makedirs(
    name="bygroup",
    exist_ok=True
)

### --------------------------------------------------------------------------------------------------------- ###
### ----------------------------------------------Load dataset----------------------------------------------- ###
### --------------------------------------------------------------------------------------------------------- ###
df = pd.read_csv(
    "EXIST_dev_es.csv",
    encoding="utf-8"
)

### --------------------------------------------------------------------------------------------------------- ###
### ----------------Prepare subset where labels are unanimous within the demographic group(s)---------------- ###
### --------------------------------------------------------------------------------------------------------- ###
df["label_task1"] = df["label_task1"].map({"NO": "No", "YES": "Yes"})
group = df.groupby(["gender_annotator", "tweet"])["label_task1"]
unanimous_annotations = group.first()[group.nunique().eq(1)]
M = unanimous_annotations.xs("M").rename("label_task1_unanimous").reset_index()
M.to_csv("bygroup/man.csv", index=False, encoding="utf-8")
F = unanimous_annotations.xs("F").rename("label_task1_unanimous").reset_index()
F.to_csv("bygroup/woman.csv", index=False, encoding="utf-8")
